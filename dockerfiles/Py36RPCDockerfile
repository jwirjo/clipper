# This ARG isn't used but prevents warnings in the build script
ARG CODE_VERSION
FROM continuumio/anaconda3:5.1.0

MAINTAINER Dan Crankshaw <dscrankshaw@gmail.com>


RUN mkdir -p /model \
      && apt-get update \
      && apt-get install -y libzmq3 libzmq3-dev \
      && conda update -n base conda \
      && conda config --set ssl_verify no \
      && conda install -c anaconda cloudpickle=0.5.2 \
      && conda install -y libgcc pyzmq libsodium \
      && pip install prometheus_client

WORKDIR /container

COPY containers/python/__init__.py containers/python/rpc.py /container/

ENV CLIPPER_MODEL_PATH=/model

HEALTHCHECK --interval=3s --timeout=3s --retries=1 CMD test -f /model_is_ready.check || exit 1

# vim: set filetype=dockerfile:
